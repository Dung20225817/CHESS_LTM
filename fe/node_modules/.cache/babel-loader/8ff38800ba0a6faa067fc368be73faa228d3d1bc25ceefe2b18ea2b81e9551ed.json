{"ast":null,"code":"var _jsxFileName = \"D:\\\\LTM\\\\CHESS\\\\fe\\\\src\\\\components\\\\context\\\\AuthContext.tsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useEffect, useState } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext(undefined);\nconst STORAGE_KEY = \"chess_user\";\nfunction makeWsUrl() {\n  const proto = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\n  const envHost = process.env.REACT_APP_WS_HOST;\n  const host = envHost || `${window.location.hostname}:8765`;\n  return `${proto}//${host}`;\n}\nexport const AuthProvider = ({\n  children\n}) => {\n  _s();\n  const [user, setUserState] = useState(null);\n  useEffect(() => {\n    try {\n      const raw = localStorage.getItem(STORAGE_KEY);\n      if (raw) setUserState(JSON.parse(raw));\n    } catch {\n      // ignore\n    }\n  }, []);\n  const persistUser = u => {\n    setUserState(u);\n    try {\n      if (u) localStorage.setItem(STORAGE_KEY, JSON.stringify(u));else localStorage.removeItem(STORAGE_KEY);\n    } catch {\n      // ignore\n    }\n  };\n  const doAuth = (type, username, password, timeoutMs = 10000) => new Promise(resolve => {\n    const url = makeWsUrl();\n    let settled = false;\n    const ws = new WebSocket(url);\n    const cleanup = () => {\n      try {\n        ws.close();\n      } catch {}\n      ws.onopen = ws.onmessage = ws.onerror = ws.onclose = null;\n    };\n    const finish = (ok, u) => {\n      if (settled) return;\n      settled = true;\n      if (u) persistUser(u);\n      cleanup();\n      resolve(ok);\n    };\n    const timer = window.setTimeout(() => finish(false), timeoutMs);\n    ws.onopen = () => {\n      try {\n        ws.send(JSON.stringify({\n          type,\n          username,\n          password\n        }));\n      } catch {\n        finish(false);\n        clearTimeout(timer);\n      }\n    };\n    ws.onmessage = ev => {\n      // Bridge usually forwards one JSON message per line. Try parse safely.\n      try {\n        const data = typeof ev.data === \"string\" ? JSON.parse(ev.data) : ev.data;\n        if (data && data.type === type) {\n          if (data.success) {\n            const u = {\n              username,\n              user_id: data.user_id || \"\"\n            };\n            finish(true, u);\n          } else {\n            finish(false);\n          }\n          clearTimeout(timer);\n          return;\n        }\n        // also accept error shapes\n        if (data && data.type === \"error\") {\n          finish(false);\n          clearTimeout(timer);\n          return;\n        }\n      } catch {\n        // ignore parse error, wait for correct message or timeout\n      }\n    };\n    ws.onerror = () => {\n      finish(false);\n      clearTimeout(timer);\n    };\n    ws.onclose = () => {\n      // if not settled, consider failed\n      if (!settled) finish(false);\n      clearTimeout(timer);\n    };\n  });\n  const login = (username, password, timeoutMs) => doAuth(\"LOGIN\", username, password, timeoutMs);\n  const register = (username, password, timeoutMs) => doAuth(\"REGISTER\", username, password, timeoutMs);\n  const logout = () => persistUser(null);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      login,\n      register,\n      logout\n    },\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 123,\n    columnNumber: 5\n  }, this);\n};\n_s(AuthProvider, \"aTD7vzr9obuSGEVlb/4lEA+Co/E=\");\n_c = AuthProvider;\nexport function useAuth() {\n  _s2();\n  const ctx = useContext(AuthContext);\n  if (!ctx) throw new Error(\"useAuth must be used within AuthProvider\");\n  return ctx;\n}\n_s2(useAuth, \"/dMy7t63NXD4eYACoT93CePwGrg=\");\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","jsxDEV","_jsxDEV","AuthContext","undefined","STORAGE_KEY","makeWsUrl","proto","window","location","protocol","envHost","process","env","REACT_APP_WS_HOST","host","hostname","AuthProvider","children","_s","user","setUserState","raw","localStorage","getItem","JSON","parse","persistUser","u","setItem","stringify","removeItem","doAuth","type","username","password","timeoutMs","Promise","resolve","url","settled","ws","WebSocket","cleanup","close","onopen","onmessage","onerror","onclose","finish","ok","timer","setTimeout","send","clearTimeout","ev","data","success","user_id","login","register","logout","Provider","value","fileName","_jsxFileName","lineNumber","columnNumber","_c","useAuth","_s2","ctx","Error","$RefreshReg$"],"sources":["D:/LTM/CHESS/fe/src/components/context/AuthContext.tsx"],"sourcesContent":["import React, { createContext, useContext, useEffect, useState } from \"react\";\r\n\r\ntype User = {\r\n  username: string;\r\n  user_id: string;\r\n};\r\n\r\ntype AuthContextType = {\r\n  user: User | null;\r\n  login: (username: string, password: string, timeoutMs?: number) => Promise<boolean>;\r\n  register: (username: string, password: string, timeoutMs?: number) => Promise<boolean>;\r\n  logout: () => void;\r\n};\r\n\r\nconst AuthContext = createContext<AuthContextType | undefined>(undefined);\r\nconst STORAGE_KEY = \"chess_user\";\r\n\r\nfunction makeWsUrl(): string {\r\n  const proto = window.location.protocol === \"https:\" ? \"wss:\" : \"ws:\";\r\n  const envHost = process.env.REACT_APP_WS_HOST;\r\n  const host = envHost || `${window.location.hostname}:8765`;\r\n  return `${proto}//${host}`;\r\n}\r\n\r\nexport const AuthProvider: React.FC<React.PropsWithChildren<{}>> = ({ children }) => {\r\n  const [user, setUserState] = useState<User | null>(null);\r\n\r\n  useEffect(() => {\r\n    try {\r\n      const raw = localStorage.getItem(STORAGE_KEY);\r\n      if (raw) setUserState(JSON.parse(raw));\r\n    } catch {\r\n      // ignore\r\n    }\r\n  }, []);\r\n\r\n  const persistUser = (u: User | null) => {\r\n    setUserState(u);\r\n    try {\r\n      if (u) localStorage.setItem(STORAGE_KEY, JSON.stringify(u));\r\n      else localStorage.removeItem(STORAGE_KEY);\r\n    } catch {\r\n      // ignore\r\n    }\r\n  };\r\n\r\n  const doAuth = (type: \"LOGIN\" | \"REGISTER\", username: string, password: string, timeoutMs = 10000) =>\r\n    new Promise<boolean>((resolve) => {\r\n      const url = makeWsUrl();\r\n      let settled = false;\r\n      const ws = new WebSocket(url);\r\n\r\n      const cleanup = () => {\r\n        try { ws.close(); } catch {}\r\n        ws.onopen = ws.onmessage = ws.onerror = ws.onclose = null;\r\n      };\r\n\r\n      const finish = (ok: boolean, u?: User) => {\r\n        if (settled) return;\r\n        settled = true;\r\n        if (u) persistUser(u);\r\n        cleanup();\r\n        resolve(ok);\r\n      };\r\n\r\n      const timer = window.setTimeout(() => finish(false), timeoutMs);\r\n\r\n      ws.onopen = () => {\r\n        try {\r\n          ws.send(JSON.stringify({ type, username, password }));\r\n        } catch {\r\n          finish(false);\r\n          clearTimeout(timer);\r\n        }\r\n      };\r\n\r\n      ws.onmessage = (ev) => {\r\n        // Bridge usually forwards one JSON message per line. Try parse safely.\r\n        try {\r\n          const data = typeof ev.data === \"string\" ? JSON.parse(ev.data) : ev.data;\r\n          if (data && data.type === type) {\r\n            if (data.success) {\r\n              const u: User = { username, user_id: data.user_id || \"\" };\r\n              finish(true, u);\r\n            } else {\r\n              finish(false);\r\n            }\r\n            clearTimeout(timer);\r\n            return;\r\n          }\r\n          // also accept error shapes\r\n          if (data && data.type === \"error\") {\r\n            finish(false);\r\n            clearTimeout(timer);\r\n            return;\r\n          }\r\n        } catch {\r\n          // ignore parse error, wait for correct message or timeout\r\n        }\r\n      };\r\n\r\n      ws.onerror = () => {\r\n        finish(false);\r\n        clearTimeout(timer);\r\n      };\r\n\r\n      ws.onclose = () => {\r\n        // if not settled, consider failed\r\n        if (!settled) finish(false);\r\n        clearTimeout(timer);\r\n      };\r\n    });\r\n\r\n  const login = (username: string, password: string, timeoutMs?: number) =>\r\n    doAuth(\"LOGIN\", username, password, timeoutMs);\r\n\r\n  const register = (username: string, password: string, timeoutMs?: number) =>\r\n    doAuth(\"REGISTER\", username, password, timeoutMs);\r\n\r\n  const logout = () => persistUser(null);\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ user, login, register, logout }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n\r\nexport function useAuth(): AuthContextType {\r\n  const ctx = useContext(AuthContext);\r\n  if (!ctx) throw new Error(\"useAuth must be used within AuthProvider\");\r\n  return ctx;\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}